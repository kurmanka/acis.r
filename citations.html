<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Citations in ACIS / ACIS documentation</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
      

   <h1 id="idp426944">Citations in ACIS</h1>

<p><a href="http://acis.openlib.org/software/doc/citations.text">document
source</a> in Markdown format
</p>

<h3><i>Table of contents</i></h3>
<p class="toc">   <a href="#idp428720">Introduction</a><br>      <a href="#idp429120">Why? What for?</a><br>      <a href="#idp436224">Workflow overview</a><br>   <a href="#user-interface">Citation profile: user interface</a><br>      <a href="#most-interesting-doc">The most interesting document</a><br>      <a href="#idp452480">Per-document screens: identified and potential tabs</a><br>      <a href="#auto-suggestions">"Auto suggestions" screen</a><br>      <a href="#idp473008">Document list screen</a><br>      <a href="#idp475200">Refused citations screen</a><br>      <a href="#idp476336">Citation profile overview screen</a><br>   <a href="#auto-update">Automatic citation profile update</a><br>      <a href="#idp484096">Automatic Update Preferences screen</a><br>      <a href="#idp488112">Notification emails</a><br>   <a href="#data-input">Citations data input</a><br>   <a href="#data-output">Citations data output</a><br>   <a href="#idp507600">Administration and configuration</a><br>      <a href="#input-configuration">Input data</a><br>      <a href="#idp513872">Citations screens parameters</a><br>   <a href="#idp516560">Technical implementation details / developer's guide</a><br>      <a href="#idp517008">Processing the citations data</a><br>         <a href="#idp523488">Citations table</a><br>         <a href="#idp529008">Citation string normalization:</a><br>         <a href="#idp531936">Cutting out the editors part</a><br>      <a href="#idp534272">Search for citations and ACPU</a><br>         <a href="#idp535152">Automatic citation profile update</a><br>         <a href="#idp541376">Search workflow</a><br>      <a href="#idp559456">Citation to document similarity</a><br>         <a href="#cit-doc-similarity-pi">Similarity assessment function interface</a><br>         <a href="#similarity-default-func">The default citation-document
similarity assessment algorithm</a><br>      <a href="#idp577456">Citation suggestions</a><br>         <a href="#idp577872">Citation to document similarity table: cit_doc_similarity</a><br>         <a href="#idp582464">other citation suggestions table: cit_sug</a><br>         <a href="#idp587024">Old suggestions table: cit_old_sug</a><br>      <a href="#idp591056">Similarity matrix</a><br>         <a href="#idp591472">Data structure</a><br>         <a href="#idp603712">main matrix operations</a><br>      <a href="#idp607776">Userdata structure</a><br>      <a href="#idp623360">Storing and passing citations around</a><br>      <a href="#idp627904">Modules</a><br>         <a href="#idp628304">ACIS::Citations</a><br>         <a href="#idp628704">ACIS::Citations::Utils</a><br>         <a href="#idp632752">ACIS::Citations::Input</a><br>         <a href="#idp635712">ACIS::Citations::Suggestions</a><br>         <a href="#idp636128">ACIS::Citations::SimMatrix</a><br>         <a href="#idp641968">ACIS::Citations::Search</a><br>         <a href="#idp645136">ACIS::Web::Citations::Profile</a><br>         <a href="#idp646000">ACIS::Web::Citations</a><br>         <a href="#idp653696">ACIS::Citations::AutoUpdate</a><br>      <a href="#idp654112">Other notes</a><br>         <a href="#idp654512">SysProf table profile parameters</a><br>         <a href="#idp657168">Consistency maintentance</a><br>         <a href="#idp659616">Database maintenance</a><br></p>


   <h2 id="idp428720">Introduction</h2>


   <h3 id="idp429120">Why? What for?</h3>

<p>Authors have a strong desire to find out</p>

<ul>
<li>how many times they have been cited,</li>
<li>which papers are citing their work,</li>
<li>which of their own papers have made the most impact as measured by citations.</li>
</ul>

<p>We want to give authors such data.  And that is our reason
no. 1.</p>

<p>This is not only to caress their vanity, but also to support
further research dialogue, especially when this data is
published in an accessible and reusable way.</p>

<p>Automated citation parsing and indexing systems exist
(CiteSeer, also see <a href="http://opcit.eprints.org/">Open
Citation</a>) and are able to
provide such data, when applied to an appropriate
collection.  But automated citation processing is
technically a very complicated task and mistakes are not
rare.</p>

<p>But we believe that the authors themselves can verify and
filter automatically produced citation data.  Thus, with the
authors' help, we will get improved citation data.  Now that
is our reason no. 2.</p>

<p>By publishing the resulting data in a simple, documented
form, an ACIS service will support creation of additional
services based on that data.</p>

<p>Therefore, we follow a two-level approach.  First level:
autonomous citation indexing.  Citations get parsed,
extracted and indexed with an automated reference and
citation parsing system.  That happens outside ACIS, by
systems like CiteSeer.</p>

<p>Second level happens in ACIS: human users review, validate
and filter the data.</p>


   <h3 id="idp436224">Workflow overview</h3>

<p>Here is what happens and what we do with citations.</p>

<p>A citation indexing service processes the same set of data
on which an ACIS service is running.  It parses the
documents' full texts and finds citations and tries to
identify, which citations point to which documents.  It then
encodes its resuls, i.e. the citations data, in the
specified <a href="#data-input">input format</a>.</p>

<p>The data is then supplied to the ACIS service.  (How the
data is transfered is out of the scope of our concern.)
Service administrator will have to get things <a href="#input-configuration">configured</a> for this.</p>

<p>Then ACIS starts <a href="#user-interface">offering</a>
citations to its users and they create their own citation
profiles.  This means they identify citations as pointing to
their own particular documents.  They reject some citations
which are not relevant to them.  At this stage ACIS
software tries hard to be helpful and make the process easy.</p>

<p>As a result of this interaction, ACIS collects improved
citations data, and <a href="#data-output">includes</a> it
into the personal data that ACIS exports.  Third-party
projects then may use it for building additional user
services based on the data.</p>

<p>In this document we first describe the user interface, then
the data formats, then the administrator's configuration
parameters.  Technical implementation details are probably
interesting to only a few; therefore, they come last.</p>


   <h2 id="user-interface">Citation profile: user interface</h2>

<p>Citation profile is a part of the ACIS web interface, where
the users deal with citations.  The users' are given power
to:</p>

<ul>
<li><p>review citations that have been identified as referring
to their works;</p></li>
<li><p>certify that particular citations point to their
particular documents, with ability to review their
choices and correct errors in their earlier-made choices;</p></li>
<li><p>refuse errorneously-suggested citations and review
previously refused citations to undo errornously-refused
items.</p></li>
</ul>

<p>ACIS will search for citations in the database (among
the data provided on input), attempt to match the citations
to the documents of the user's research profile, and offer
them to the user for review and identification.</p>

<p><em>Design requirements.</em> The screens of the citation profile
should look and work similar to those of the research
profile.  Consistency has to be maintained.</p>


   <h3 id="most-interesting-doc">The most interesting document</h3>

<p>Before we offer any citations to the user for
identification, we will assess all the citations found for
her.  By matching (comparing) the citations to the
descriptions of the documents of her research profile, we
will find:</p>

<ol>
<li><p>which document is the most <em>interesting</em> in a sense that
it has most potential new citations pointing to it
(weighted by their respective similarity measure);</p></li>
<li><p>which citations more closely resemble which document's
description.</p></li>
</ol>

<p>This will give us the order, in which to present the
documents and citations to the user: we will always show the
most interesting document first (see <a href="#auto-suggestions">auto suggestions</a>) and the most
relevant citations at the top.  Depending on the similarity
level, some of the citations will be pre-selected for
identification by default.</p>


   <h3 id="idp452480">Per-document screens: identified and potential tabs</h3>

<p>Main work on citations happens on per-document screens,
which means the user operates on citations for one
particular item of her research profile at a time. The title
and other details of the document are shown in large type at
the top of the screen. Then there are two tabs on the page,
labeled <em>identified</em> and <em>potential</em>.</p>

<p>In the <em>identified</em> tab, the user sees the list of all the
citations that she has identified to the document. She can
remove the citations that have been mistakenly
identified. Such citations become avalailable for all
documents of her (to which they match). They are then
displayed as new citations, even in the potential tab for
the current document.</p>

<p class="img"><img class="snap" src="img/citations/identified-page-at-65p.png" alt="identified citations screen snapshot">
</p>



<p>In the potential tab we offer citations for user to
identify.  We only offer citations that we found similar to
the description of the document.</p>

<p>Two kinds of citations may be offered: "new" and "old".
Old citations are the ones that we have already suggested
to the user for this particular document in the past.  (Thus
a citation can only be old for a certain document.)  A
citation becomes old only after we suggested it to a user
and the user submitted the form, but did not select this
citation for inclusion.  If she didn't submit the form,
which included this citation as new, we will still consider
it new.</p>

<p class="img"><img class="snap" src="img/citations/autosuggested-page-v4-at-65p.png" alt="potential citations screen snapshot">
</p>



<p>We present the potential citations as shown in the prototype
page linked above. The old citations will not be shown by
default, only if the user requests it.  Both old and new
citations are ordered by decreasing similarity of the
citation to the document.  Some of the new citations,
i.e. for which the similarity is higher than a certain
threshold, will have the checkbox checked by default.  The
threshold level is configureable by system administrator.</p>

<p>The "Not my work" button removes a citation from the pool of
potential citations for all the documents, and puts it into the
refused citations list.</p>

<p>If the user presses the SUBMIT FORM button, all checked citations
will be identified as pointing to that document.  They will no
longer be suggested for identification to other documents.</p>

<p>When there is at least one other document with new citations for
it, we show a checkbox near the submit button, labeled "Show next
document with new citations".  This checkbox will be checked by
default if the current page offers any new citations.  If the
checkbox is checked when the form is submitted, we process the
user's choices and then redirect her to the next <a href="#most-interesting-doc">most interesting document</a>.</p>

<p>If we have no potential citations for the document in
question, we will show a message saying:</p>

<pre><code>We have no citations to suggest for this document at this time.
</code></pre>


   <h3 id="auto-suggestions">"Auto suggestions" screen</h3>

<p>When the system has some new unidentified citations for a
user, and the user enters citation profile, we take the user
to the AUTO SUGGESTIONS screen.  </p>

<p>On it we always show the user the <em>potential</em> tab for a
document with new citations.  The document we show there is
always the <a href="citations.html#most-interesting-doc">most interesting
document</a>.  When user deals with these citations, another
document would (very likely) become the most interesting.
If she doesn't uncheck the "move on" checkbox ("Show next
document with new citations"), she would be shown the next
most interesting document immediately after dealing with the
current one.  If the user follows this simple procedure, she
will be taken through all the new potential citations for
her documents, going through the most cited documents first.</p>

<p>The screen is always accessible via "auto suggestions"
link-item in the right-hand top corner menu (under
"Citations:").  So if user deviates from the procedure, it
would be easy for her to continue.  When displaying this
screen, we highlight this link as a link to the current
screen (and it won't be a link).</p>

<p>For navigation between the documents the users have the
"Next" and "Prev" links to the right and left of the
document title (respectively).  The "Next" link leads to the
second most interesting document (if there is such a
document).</p>

<p><strong>What if there are no new citations?</strong></p>

<p>If there are no documents for which we have any new
citations, we show a brief screen with this message:</p>

<pre><code>We are sorry to tell you that we have no potential
citations data for the documents in your research
profile.
</code></pre>

<p>If the user has no documents in the research profile, we
show this message instead:</p>

<pre><code>We are sorry to tell you that we have no potential
citations data for the documents in your research
profile, because your research profile is empty.
</code></pre>


   <h3 id="idp473008">Document list screen</h3>

<p>A table of all documents (research profile items) is shown
on the "Document list" screen. It also provides numbers of
citations identified to each document and number of new
potential citations for each. Each line in the table
provides both a link to the identified tab for that document
and a link to the potential tab for it. The table may be
sorted by the number of citations identified, or by the
number of new potential citations for it.</p>

<p>Each document in the table will be presented by a title and a link to its
further details.</p>

<p>The screen will also display the total number of identified
citations.</p>


   <h3 id="idp475200">Refused citations screen</h3>

<p>On the Refused Citations screen users will deal with
citations, for which user has pressed the "Not my work" button
in the past. Those are the citations to works that the user
has told us she is not an author of. She can remove citations,
which then may be suggested to the same or other documents,
depending on similarity found.</p>


   <h3 id="idp476336">Citation profile overview screen</h3>

<p>The main page of the citation profile gives a brief
introduction and overview of the profile, with links to
appropriate screens.  This is similar to research profile
overview screen.  It offers links to the document list
screen, to the auto suggestions screen (i.e. the most
interesting document, if there is such a document at the
time), and a link to the refused citations screen.</p>

<p>If there are new potential citations for some documents of a
person, on the first enterance of the person into his
citation profile, we redirect him to the <a href="#auto-suggestions">auto suggestions</a> page.  But we
do this only once per user session to avoid confusion.</p>




   <h2 id="auto-update">Automatic citation profile update</h2>

<p>Similar to the automatic research profile update, ACIS may
sometimes update citation profiles for its users
automatically.  There are three such cases, when a citation
can be added to the profile:</p>

<ul>
<li><p>when a citation has been identified by the autonomous citation indexing
service as pointing to a document of a user;</p></li>
<li><p>when we find that a new citation has a very high similarity to one of the
documents of a user (as measured by the citation-to-document similarity
assessment algorithm);</p></li>
<li><p>when two or more users have collectively authored a document, and that
document is included into their research profiles, and one of the users has
identified a citation as pointing to that document.</p></li>
</ul>

<p>Then if the citation profile is updated, an email message
is sent to the user (the owner of the profile) to notify her
about the changes.  </p>


   <h3 id="idp484096">Automatic Update Preferences screen</h3>

<p>Some users most certainly won't trust automatic changes or
experience problems with it.  Therefore, even though these
features are enabled by default for all users, they can
disable them.  To disable these features, users use the
Automatic Update Preferences screen.  There is a similar
screen in the research profile.</p>

<p>Difference between the first two cases of automatic citaiton
addition is difficult to explain to users, and, therefore,
it will be regulated by one user option.</p>

<p>The screen offers several yes/no questions-options.</p>

<pre><code>AUTOMATIC CITATION PROFILE UPDATE

We can do automatic additions to your citation profile
in certain cases (explained below).  An email
notification will be sent to you every time we change
your profile automatically.  Here you may disable or
enable automatic changes to your profile.

When we know with high certainty that a new citation is
pointing to one of your works, should we automatically
add it to your identified citations? (You can always fix
it later, if a mistake happens.)

   (*) yes
   ( ) no

When one of your co-authors has identified a citation as
pointing to your co-authored document, should we add
it to your profile also?

   (*) yes
   ( ) no

The notification message will arrive from address:

    acis@somewhere.org

Please add this address to your spam filter's whitelist
to make sure it does not stop these messages.
</code></pre>

<p>A link to this screen is labeled "AUTO UPDATE" in the
citation profile menu (right-hand top corner navigation
menu).</p>


   <h3 id="idp488112">Notification emails</h3>

<p>Automatic citation profile update and research profile
update are separate functions of ACIS.  Notification
messages generated by these functions are separate.</p>

<p>To avoid bombarding users with notification emails, we don't
do automatic updates for a single personal profile more
often than once in two weeks.</p>

<p>An automatic citation profile update notification message
may look like this:</p>

<pre><code>From: acis@somewhere.org
To: A.U. Thor &lt;author@email.edu&gt;
Subject: [GAS] citations automatically added

Dear A.U. Thor,

This is an automatic message from Great Author
Service. You don't need to reply.

We ran a search for citations to your documents in our
service and found some, which we think point to these
your documents, see below.  We added these citations to
your profile, but if there's an error, you can fix it.

Document: 

    Imperfect Capital Markets Need Not be Inefficient
    paper by David Webb &amp; David De Meza
    http://ideas.repec.org/p/fmg/fmgdps/dp0007.html

Citations:

  * in: Exact joint forecasts for vector aggressive 
    models by Lu-Sam Xiu
    http://ideas.repec.org/p/xiu/xiudps/2001.html

    cited as: Webb D., De Meza D. 1999. Imperfect 
    Capital Markets Need Not be Inefficient.  Financial 
    Markets Group, Discussion papers.  

    ...


To review and correct these items, log into your profile
at this address:
http://gas.somewhere.org/citations/doclist

If necessary, review and change your preferences with
regard to future automatic citation profile updates at:
http://gas.somewhere.org/citations/autoupdate

Your password in our service is:

    supersecret

---

The message was automatically generated by Great Author Service.

http://gas.somewhere.org/
</code></pre>


   <h2 id="data-input">Citations data input</h2>

<p>Data comes from automatic reference and citation parsing
systems, e.g. CitEc, CiteSeer.</p>

<p>For ACIS to process and use citation data, the data must be
encoded in the <a href="http://amf.openlib.org/">Academic
Metadata Format</a> and the system must be <a href="#input-configuration">configured</a> appropriately.</p>

<p>Two kinds of citations are expected in the input data:</p>

<ul>
<li>identified;</li>
<li>unidentified.</li>
</ul>

<p><em>Identified</em> are the citations, which have an autonomously
identified citation targets.  That is, the software on the
citations data provider side has found that such a citation
points to a particular document in the same set of documents
and the identifier of that cited document is included with
the citation itself.</p>

<p>Therefore, the <em>unidentified</em> citations are those, which
point to an unknown document, which may be present in the
document database of ACIS or may not be present.</p>

<p>Identified citations will be encoded in this way:</p>

<pre><code>&lt;text ref="text"&gt;
   &lt;references&gt;
     &lt;acis:referencestring&gt; text of citation &lt;/acis:referencestring&gt;
     &lt;text ref="text2"/&gt;
   &lt;/references&gt;
&lt;/text&gt;
</code></pre>

<p>where acis is a prefix for the namespace
"http://acis.openlib.org/" and text2 is the identifier of
the document that the citation points to. The citation
string comes in the text content of the foreign-namespace
element referencestring.</p>

<p>While it is technically valid AMF to have several text nouns as children of
the references verb, ACIS will only accept the first one. Thus</p>

<pre><code>&lt;text ref="text"&gt;
   &lt;references&gt;
     &lt;acis:referencestring&gt; text of citation 1 &lt;/acis:referencestring&gt;
     &lt;text ref="text1"/&gt;
     &lt;acis:referencestring&gt; text of citation 2&lt;/acis:referencestring&gt;
     &lt;text ref="text2"/&gt;
   &lt;/references&gt;
&lt;/text&gt;
</code></pre>

<p>will ignore citation 2. To get both citation 1 and citation 2, you have to say</p>

<pre><code>&lt;text ref="text"&gt;
   &lt;references&gt;
     &lt;acis:referencestring&gt; text of citation 1 &lt;/acis:referencestring&gt;
     &lt;text ref="text1"/&gt;
   &lt;/references&gt;
   &lt;references&gt;
     &lt;acis:referencestring&gt; text of citation 2&lt;/acis:referencestring&gt;
     &lt;text ref="text2"/&gt;
   &lt;/references&gt;
&lt;/text&gt;
</code></pre>

<p>Unidentified citations are written as:</p>

<pre><code>&lt;text ref="text"&gt;
   &lt;reference&gt;
     &lt;literal&gt; unidentified citation &lt;/literal&gt;
   &lt;/reference&gt;
&lt;/text&gt;
</code></pre>

<p>If data comes in such a form:</p>

<pre><code>&lt;text ref="text"&gt;
   &lt;references&gt;
     &lt;text ref="text2"/&gt;
   &lt;/references&gt;
&lt;/text&gt;
</code></pre>

<p>then nothing is being done with it. </p>


   <h2 id="data-output">Citations data output</h2>

<p>We will output citations data as part of the personal
profile AMF datafiles. The citations data will be added to
the document data, i.e. the research profile.  Personal AMF
data always includes a person noun.  Here is an incomplete
example showing how would identified citations added to the
documents data:</p>

<pre><code>&lt;person id="donald_duck"&gt;
  &lt;name&gt;Donald Duck&lt;/name&gt;
  &lt;isauthorof&gt;
    &lt;text ref="text0"&gt;
       &lt;isreferencedby&gt;
          &lt;text ref='text4'/&gt;
       &lt;/isreferencedby&gt;
    &lt;/text&gt;
  &lt;/isauthorof&gt;
  &lt;isauthorof&gt;
     &lt;text ref="text20"&gt;
       &lt;isreferencedby&gt;
          &lt;text ref='text5'/&gt;
       &lt;/isreferencedby&gt;
       &lt;isreferencedby&gt;
          &lt;text ref='text6'/&gt;
       &lt;/isreferencedby&gt;
     &lt;/text&gt;
  &lt;/isauthorof&gt;
&lt;/person&gt;
</code></pre>

<p>The identified citations would not be displayed on the
personal profile pages, generated for each profile in ACIS.</p>


   <h2 id="idp507600">Administration and configuration</h2>


   <h3 id="input-configuration">Input data</h3>

<p>Citation data can be "fed" to an ACIS service only in the
form of a collection of metadata files.</p>

<p>That means you should configure a new <a href="daemon.html#collection">metadata collection</a> via the
<a class="c" href="conf.html#metadata-collections">metadata-collections</a> parameter.  To make ACIS aware,
that it should expect <strong>citation</strong> data in it, set the
collection's type (<a class="c" href="conf.html#metadata--type">metadata-X-type</a> parameter) to
"CitationsAMF".</p>

<p>It may look like this:</p>

<pre><code>metadata-collections='RePEc CitEc'
metadata-RePEc-home=/data/RePEc/amf
metadata-RePEc-type=AMF
metadata-CitEc-home=/data/CitEc/amf
metadata-CitEc-type=CitationsAMF
</code></pre>

<p>The data files <strong>must</strong> have <strong><code>.amf.xml</code></strong> name
extension to be processed by ACIS.</p>


   <h3 id="idp513872">Citations screens parameters</h3>

<p>The citation profile is enabled and configured via the the <a href="conf.html">main.conf</a> configuration file.  (Just as every
other part of the ACIS web interface.)</p>

<p>See <a href="conf.html#cit-screen-conf">Citations screens</a> parameters in
another document.</p>


   <h2 id="idp516560">Technical implementation details / developer's guide</h2>


   <h3 id="idp517008">Processing the citations data</h3>

<p><em>The data processing flow.</em>  RePEc::Index and
RePEc::Index::Collections::CitationsAMF to
ACIS::Citations::Input via the collection's proc parameter.</p>

<p>RePEc::Index::Collections::CitationsAMF uses AMF::Parser to parse the files.
Citations originating from a document will comprise one record.</p>

<p>ACIS::Citations::Input saves the data into the citations table and removes
disappeared citations.</p>

<ul>
<li><p>find the document's sid and details URL</p></li>
<li><p>load from the citations table all the known citations originating from the
document</p></li>
<li><p>find new / disappeared</p></li>
<li><p>normalize new</p></li>
<li><p>remove editor names from new</p></li>
<li><p>save new</p></li>
<li><p>remove disappeared</p></li>
</ul>


   <h4 id="idp523488">Citations table</h4>

<p>The fields:</p>

<ul>
<li>unique numeric citation id: <code>cnid SERIAL</code>
</li>
<li>long citation id: <code>clid CHAR(38) NOT NULL PRIMARY KEY</code>:
srcdocsid + '-' + checksum (MD5 checksum of the original citation
string in base64 encoding - 22 chars)</li>
<li>full original citation string: <code>ostring TEXT NOT NULL</code>
</li>
<li>normalized searchable citation string: <code>nstring VARCHAR(255) NOT NULL</code>
</li>
<li>refers to document, id: <code>trgdocid VARCHAR(255)</code>
</li>
</ul>

<p><code>FULLTEXT INDEX (nstring), INDEX (trgdocid)</code></p>


   <h4 id="idp529008">Citation string normalization:</h4>

<ul>
<li>Unicode decomposition, </li>
<li>convert letters to upper case, </li>
<li>remove all non-letter, non-digit and non-whitespace characters,</li>
<li>compact all whitespace, </li>
<li>remove leading and trailing whitespace.</li>
</ul>


   <h4 id="idp531936">Cutting out the editors part</h4>

<p>The original citation string may contain editor names, which
we don't want, because they will cause the citation to be
found mistakenly for authors.</p>

<p>The regular expression:</p>

<pre><code>s/\b((I|i)n\W.+?\Wed\..*)$//
</code></pre>

<p>should do the trick.</p>


   <h3 id="idp534272">Search for citations and ACPU</h3>

<p>Via APU. ACIS::APU -&gt; ACIS::Citations::AutoUpdate -&gt; ACIS::Citations::Search</p>


   <h4 id="idp535152">Automatic citation profile update</h4>

<p>Former ARPU has been extended to cover citations and they now
jointly known as APU: automatic profile update.</p>

<p>APU has a number of configuration parameters:</p>

<p id="minimum-apu-period-days" C="minimum-apu-period-days"><code class="C">minimum-apu-period-days</code> minimum APU period (default: 3
weeks or 21 day(?)).</p>

<p id="echo-apu-mails" C="echo-apu-mails"><code class="C">echo-apu-mails</code>, boolean -- whether to send a copy of
the APU mails to the admin or not.</p>

<p id="disable-citation-mails" C="disable-citation-mails"><code class="C">disable-citation-mails</code>, boolean -- whether to send
citation mails at all.</p>

<p>ACPU itself includes 3 things:</p>

<ol>
<li>profile maintenance (clean-up)</li>
<li>search</li>
</ol>

<p>Every time ACPU is done, a timestamp is added to the sysprof
table for that record ('last-auto-citations-time').</p>

<p>When APU is about to run, it chooses those records, which have
their ACPU or ARPU timestamps oldest, just as it is now done
for ARPU only.  </p>


   <h4 id="idp541376">Search workflow</h4>

<p>For each research profile item of the user, we do something like:</p>

<pre><code>select * from citations where trgdocid = 'repec:fdd:fodooo:555';
</code></pre>

<p>and it finds us citations which where pre-identified as pointing to
that document.  Pre-identified means identified by the citations data
provider.</p>

<p>For each name variation of the user we do:</p>

<pre><code>select * from citations where MATCH (nstring) AGAINST
('JOHN MALKOVICH' IN BOOLEAN MODE)
</code></pre>

<p>(this is a simplified variation of the actual query.)</p>

<p>Then we exclude (from what's found) the already known: identified and
refused citations.  Then we exclude citations already suggested.</p>

<p>Then those that are left we compare to the <abbr title="research profile">RP</abbr> documents and look at what
came out of it.  If anything interesting came out -- we add
those.  But we do not add a citation if it has already been
suggested in the past, i.e. if it is old.  Ok, let's look closer at it.</p>

<p>THE WORKFLOW</p>

<ul>
<li>
<p>by the person's research profile documents:</p>

<ul>
<li><p>find citations, that were pre-identified for a document</p></li>
<li><p>filter out identified citations</p></li>
<li><p>filter out refused citations</p></li>
<li><p>filter out old, suggested in the past items (cit_old_sug table)</p></li>
<li>
<p>then, for the rest of citations:</p>

<ul>
<li>auto add them, if preferences allow</li>
</ul>
</li>
</ul>
</li>
<li>
<p>the person's name:</p>

<ul>
<li><p>find citations, that match the person's name variations</p></li>
<li><p>filter out identified citations</p></li>
<li><p>filter out refused citations</p></li>
<li><p>filter out old, suggested in the past items (cit_old_sug table)</p></li>
<li>
<p>then, for the rest of citations:</p>

<ul>
<li><p>compare them to the person's documents </p></li>
<li><p>comparison results would be written to
the cit_doc_similarity table </p></li>
</ul>
</li>
<li>
<p>then, if auto-add is enabled for this profile</p>

<ul>
<li><p>find which of the new citations have high similarity
measure to a document (and which have the highest, if
there's several of them)</p></li>
<li><p>auto add them, if preferences allow</p></li>
</ul>
</li>
</ul>
</li>
</ul>


   <h3 id="idp559456">Citation to document similarity</h3>


   <h4 id="cit-doc-similarity-pi">Similarity assessment function interface</h4>

<p>The citation-document similarity function (see
<a class="c" href="conf.html#citation-document-similarity-func">citation-document-similarity-func</a>) will be called by
ACIS like this:</p>

<pre><code>$sim = func( CIT, DOC );
</code></pre>

<p>where CIT is a reference to a citation record, DOC is a
reference to a document record and $sim is a similarity
value returned by the function.</p>

<dl>
<dt>CIT</dt>

<dd>
<p>is a reference to a hash:</p>

<pre><code>{ ostring =&gt; CITSTR, 
  nstring =&gt; NORCITSTR }</code></pre>

<p>Here CITSTR is the original citation string, and
NORCITSTR is the normalized citation string.</p>

</dd>

<dt>DOC</dt>
<dd>
<p>is a reference to a hash:</p>

<pre><code>{ title   =&gt; TITLE,
  authors =&gt; [ AUTHOR1NAME, AUTHOR2NAME, ... ],
  type    =&gt; TYPE,
  location =&gt; LOCATION
}</code></pre>

<p>Here TITLE is the work's title (a string), AUTHOR1NAME,
AUTHOR2NAME and so on are the names of the authors
(strings), and TYPE is one of "article", "paper", "book",
"software", "chapter", "text" (when no particular type is
known).</p>

<p>LOCATION is a string built by joining the following items: the series or
journal name, the paper's number in the series (if it is present), the
issue/volume/pages.  For AMF we can take all the adjectives of the serial
adjective container.</p>

</dd>
</dl>


   <h4 id="similarity-default-func">The default citation-document
similarity assessment algorithm</h4>

<p>For a given document and a given citation:</p>

<ol>
<li>
<p>Look at the author names first. Split the names of the authors of the
document into a list of words, strip all non-letter non-whitespace
characters and then strip single whitespace-separated letters from it. </p>

<p>We then search for approximate matches for each of these words in the
normalized citation string. (String::Approx) If there is a match for any of
the author-name-words, it is an "author pass".  Otherwise, the match is
aborted with zero similarity measure returned.</p>

<pre><code>foreach ( @names ) {
  if ( amatch( $_, $citation ) ) {
    $pass = 1;
    last;
  }
}</code></pre>

<p>If the document is an author pass, it will be ranked according to the
string similarity of the title only, see next point.</p>
</li>
<li>
<p>Compare titles.  Take the normalized citation string and take the normalized
title of the research item.  Find where in the citation
string the first word of the title is present.</p>

<p>Take as many characters of the citation string as there
are in the title and compare them to the work's title
(with <a href="http://search.cpan.org/perdoc?String::Similarity">String::Similarity</a>).</p>

<p>(Alternatively, find where in the citation string the last word of the
title is present and take a substring from start to end.  Compare in the
same way.)</p>

<p>(Alternatively, do a String::Approx amatch on the citation
string, with the document's title used as the pattern. --
No, this will result in just yes/no value, but we need a
numeric measure.)</p>
</li>
</ol>



<p>Get the comparison result as a number between 0 and 1.</p>

<ul>
<li>Also see <a href="http://citeseer.ist.psu.edu/aci-computer/aci-computer99.html">Digital Libraries and Autonomous Citation
Indexing</a>
paper and its section "Methods" for a brief discussion of
what CiteSeer team tried.</li>
</ul>


   <h3 id="idp577456">Citation suggestions</h3>


   <h4 id="idp577872">Citation to document similarity table: cit_doc_similarity</h4>

<p>Table cit_doc_similarity fields:</p>

<ul>
<li>citation id: <code>cnid BIGINT UNSIGNED NOT NULL</code>
</li>
<li>document short id: <code>dsid CHAR(15) NOT NULL</code>
</li>
<li>similarity measure 0...100: <code>similar TINYINT NOT NULL</code>
</li>
<li>when compared: <code>time DATETIME NOT NULL</code>
</li>
</ul>

<p><code>PRIMARY KEY (cnid,dsid)</code></p>


   <h4 id="idp582464">other citation suggestions table: cit_sug</h4>

<p>Table cit_sug fields:</p>

<ul>
<li>citation id: <code>cnid BIGINT UNSIGNED NOT NULL</code>
</li>
<li>document short id: <code>dsid CHAR(15) NOT NULL</code>
</li>
<li>reason: <code>reason CHAR(20) NOT NULL</code>
</li>
<li>when suggested: <code>time DATETIME NOT NULL</code>
</li>
</ul>

<p><code>PRIMARY KEY (cnid,dsid,reason)</code></p>


   <h4 id="idp587024">Old suggestions table: cit_old_sug</h4>

<p>Table cit_old_sug fields:</p>

<ul>
<li>short id of the person to whom we suggested it: <code>psid CHAR(15) NOT NULL</code> </li>
<li>document short id: <code>dsid CHAR(15) NOT NULL</code>
</li>
<li>citation id: <code>cnid BIGINT UNSIGNED NOT NULL</code>
</li>
</ul>

<p><code>PRIMARY KEY (psid,dsid,cnid)</code></p>


   <h3 id="idp591056">Similarity matrix</h3>


   <h4 id="idp591472">Data structure</h4>

<p>matrix:</p>

<ul>
<li>
<p>new (hash):</p>

<ul>
<li>document sid1 | citations list (each with reason &amp; similarity)</li>
</ul>
</li>
<li>
<p>old (hash):</p>

<ul>
<li>document sid1 | citations list (each with reason &amp; similarity)</li>
</ul>
</li>
<li>
<p>totals_new (hash):</p>

<ul>
<li>document sid1 | total similarity of the new
citations, a real positive value</li>
</ul>
</li>
<li><p>doclist (list): list of document sids in the order of
decreasing similarity (based on totals_new)</p></li>
<li>
<p>citations (hash):</p>

<ul>
<li>citation cnid | hash:
<ul>
<li>docsid | list of [ 'new', $suggestion ] or
['old', $suggestion ]</li>
</ul>
</li>
</ul>
</li>
<li><p>psid: personal record short id</p></li>
</ul>

<p>"dxx44"                     -- research profile item's sid</p>

<p>$matrix -&gt; {new} {dxx44}[0] -- the first of the new citations
                               suggested for research profile
                               item dxx44</p>

<p>$matrix -&gt; {new} {dxx44}[1]-&gt;{similar} -- similarity of the
                            second citation's to dxx44 document</p>

<p>$matrix -&gt; {citations} {'dcen4-n6Ci5dmzFdBAtQx4K+mEjg'}
{dxx44} -- array of where this citation is suggested.</p>

<p>$matrix -&gt; {citations} {'dcen4-n6Ci5dmzFdBAtQx4K+mEjg'}
{dxx44}[0][0] -- 'new' or 'old'</p>

<p>$matrix -&gt; {citations} {'dcen4-n6Ci5dmzFdBAtQx4K+mEjg'}
{dxx44}[0][1] -- reference to the particular suggestion hash</p>

<p>Similarity values in the matrix and in the cit_doc_similarity
table are all in the percent scale.  They are produced by
multiplying the similarity values (calculated by the
cit-to-document comparison function) by 100.</p>


   <h4 id="idp603712">main matrix operations</h4>

<ul>
<li><p>load the matrix</p></li>
<li><p>calculate totals</p></li>
<li><p>get most interesting document (dsid)</p></li>
<li><p>consider new citations</p></li>
<li><p>remove citation</p></li>
<li><p>citation status change new to old</p></li>
</ul>


   <h3 id="idp607776">Userdata structure</h3>

<p>The <strong><code>citations</code></strong> branch of the userdata structure:</p>

<ul>
<li>
<p><code>identified</code>: <em>hash</em></p>

<ul>
<li>document short id: a list of citations</li>
<li>next doc short id: another list of citations</li>
<li>...</li>
</ul>
</li>
<li><p><code>refused</code>: a list of citations</p></li>
<li>
<p><code>meta</code>: hash</p>

<ul>
<li>
<code>co-auth-auto-add</code>: auto co-authorship update option</li>
<li>
<code>auto-identified-auto-add</code>: auto pre-identified update option</li>
<li>
<code>auto-add-similarity-threshold</code>: a number</li>
<li>
<code>last-searched-nameset-date</code>: date of the last searched name variations set</li>
</ul>
</li>
<li><p>potential new &amp; old citations we will store in the
cit<em>doc</em>similarity, cit<em>sug and cit</em>old_sug tables</p></li>
</ul>

<p id="userdata-citation-item">Each citation item in the userdata is a hash
with these items:</p>

<ul>
<li>cnid</li>
<li>ostring </li>
<li>srcdocid</li>
<li>srcdoctitle</li>
<li>srcdocauthors</li>
<li>srcdocurlabout</li>
<li>reason (if manually added)</li>
<li>autoaddreason (if automatically added)</li>
<li>autoadded (if automatically added)</li>
</ul>


   <h3 id="idp623360">Storing and passing citations around</h3>

<p>Citations will be stored as:</p>

<ol>
<li><p>citation table records</p></li>
<li><p>in-memory suggestions</p></li>
<li><p>userdata items (see <a href="#userdata-citation-item">above</a>)</p></li>
</ol>

<p>Basically, the citations will go from 1 to 2 and from 2 to 3.  At each
step, some hash keys may be added to a citation or may be removed.  </p>

<p>But sometimes a citation is removed from userdata and then it may be
re-considered as a suggestion (3-&gt;2). </p>


   <h3 id="idp627904">Modules</h3>


   <h4 id="idp628304">ACIS::Citations</h4>


   <h4 id="idp628704">ACIS::Citations::Utils</h4>

<ul>
<li><p>normalize_string( string )</p></li>
<li><p>build_citations_index( citlist, [index] ); - build a hash
of [ cnid: citation ] pairs ???</p></li>
<li><p>get_document_authors();  - for co-authors' claims</p></li>
<li><p>cit_document_similarity( cit, doc ) -- <a href="#similarity-default-func">default cit-doc similarity func</a></p></li>
</ul>

<p>and other useful stuff</p>


   <h4 id="idp632752">ACIS::Citations::Input</h4>

<p>use ACIS::Citations::Utils;</p>

<ul>
<li><p>process_citation( cit ) - normalize, cut the editors, calculate the checksum</p></li>
<li><p>save_citation( cit )</p></li>
<li><p>check_citation( cit ) - reload citation from the citations table or return
undef otherwise</p></li>
</ul>


   <h4 id="idp635712">ACIS::Citations::Suggestions</h4>


   <h4 id="idp636128">ACIS::Citations::SimMatrix</h4>

<p>use ACIS::Citations::Suggestions;</p>

<p>exported:</p>

<ul>
<li>load_similarity_matrix( record ); - returns matrix structure as
specified above</li>
</ul>

<p>object methods:</p>

<ul>
<li><p>most_interesting_doc( ); </p></li>
<li><p>remove_citation( $matrix, $cit );   </p></li>
</ul>

<p>...</p>

<p>internal:</p>

<ul>
<li>
<em>calculate</em>totals( $matrix );</li>
</ul>


   <h4 id="idp641968">ACIS::Citations::Search</h4>

<p>use ACIS::Citations::Utils;
use ACIS::Citations::Suggestions;</p>

<p>exportable:</p>

<ul>
<li><p>search_for_document( id ) - find pre-identified citations</p></li>
<li><p>search_for_personal_names( names ) </p></li>
</ul>

<p>...</p>


   <h4 id="idp645136">ACIS::Web::Citations::Profile</h4>

<p>use ACIS::Citations::Input;
use ACIS::Web::SysProfile;</p>


   <h4 id="idp646000">ACIS::Web::Citations</h4>

<ul>
<li><p>acis_citations_enabled() - check that <a class="c" href="conf.html#citations-profile">citations-profile</a> parameter has
a true value in <a class="f" href="conf.html#mainconf">main.conf</a>; returns true or false  [15 min]</p></li>
<li><p>prepare() [30 min]</p></li>
<li><p>prepare_identified() [30 min]</p></li>
<li><p>process_identified() [60 min]</p></li>
<li><p>prepare_potential()  [30 min]</p></li>
<li><p>process_potential()  [60 min]</p></li>
<li><p>process_not_my_work() [30 min]</p></li>
<li><p>prepare_refused()    [30 min]</p></li>
<li><p>process_refused()    [60 min]</p></li>
<li><p>auto_suggestions()   [30 min]</p></li>
<li><p>prepare_doclist()    [30 min]</p></li>
</ul>


   <h4 id="idp653696">ACIS::Citations::AutoUpdate</h4>


   <h3 id="idp654112">Other notes</h3>


   <h4 id="idp654512">SysProf table profile parameters</h4>

<ul>
<li><p>last profile check time (seconds since the epoch):
<code>last-cit-prof-check-time</code> </p></li>
<li><p>last citation search date/time (seconds):
<code>last-auto-citations-time</code></p></li>
</ul>


   <h4 id="idp657168">Consistency maintentance</h4>

<p>Every once in a while we check that every citation that is mentioned in
the personal profile is still present in the citations table, and clear
it, if it isn't there.</p>

<p>We will remember the date of last cleaning run and at each user login
(real or in APU) we will see if the profile needs cleaning already.
(<code>last-cit-prof-check-time</code> in sysprof).</p>

<p>In a similar way, we ensure that every document for which we have the
identified citations is still present in the database.</p>


   <h4 id="idp659616">Database maintenance</h4>

<p>It would be highly desirable to backup the citations, citations_deleted
and other related tables regularly.  It is important for consistency of
the data and stability of the user profiles.</p>

<p></p>

  
<address class="footer">
<p>
$Id$
</p>
<p>Generated: Mon Apr 21 17:07:44 2014</p>
<p><a href="http://acis.openlib.org/">ACIS project</a>,
          acis<i>@</i>openlib<span>.org</span></p>
</address>
</body>
</html>
